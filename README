Pepare for dataset
In our code, you need to prepare for tree dataset for our training dataset
1.1 一个是带有50个label数据按照nnunet的格式存到Task777_CoarseFinetune
1.2 一个是带有50个label数据和2000个Unlabel数据（After 裁剪腹部）按照nnunet的格式存到Task888_FLARESSL。
1.3 一个是带有50个label数据按照nnunet的格式存到Task666_FineFinetune，裁剪过后

For Training
1.install nnUNet-master-ori，使用第二套数据集进行训练。得到粗分割模型,然后对2000个Unlabel进行推理得到分割结果。
#train
cd nnUNet-master-ori
pip install -e .
nnUNet_plan_and_preprocess -t 777 -pl2d None
nnUNet_train 3d_lowres nnUNetTrainerV2 777 0
#for unlabel data
nnUNet_predict -i ./data/Unlabel/images -o data/Task888/labelsTr
cp -r ./data/Unlabel/images ./data/Task888/imagesTr
#for label data
cp -r ./data/Label/labels ./data/Task888/labelsTr
cp -r ./data/Label/images ./data/Task888/imagesTr

2.安装nnUNet-master-data-ssl，这个版本的目的是将50个label数据和2000个Unlabel数据进行数据预处理，然后对模型进行半监督训练，模型的训练计划存放到experiment_planning/experiment_planner_baseline_3DUNet 中，半监督算法和数据分离计划在training/network_training/nnUNetTrainerV2，在这里使用的是个体归一化算法对数据进行归一化。
cd nnUNet-master-data-ssl
pip install -e .
根据分割结果对2000个Unlabel的数据进行腹部器官裁剪。将裁剪的CT存到Task888_FLARESSL的imagesTr中，2000个Unlabel数据的labelsTr使用推理结果。
python crop_img1.py
nnUNet_plan_and_preprocess -t 888 -pl2d None
nnUNet_train 3d_lowres nnUNetTrainerV2 888 0


3.安装nnUNet-master-finetune-coarseseg，这个版本的目的是使用第二步中的模型在Task777_CoarseFinetune数据上进行Coarse Model 进行微调，在这里对数据使用的是个体归一化算法
cd nnUNet-master-finetune-coarseseg
pip install -e .
nnUNet_train 3d_lowres nnUNetTrainerV2 777 0 -pretrained_weights nnUNet_trained_models/nnUNet/3d_fullres/Task888_FLARESSL/nnUNetTrainerV2__nnUNetPlansv2.1/fold_0/model_final_checkpoint.model

4.nnUNet-master-finetune-fineseg，这个版本的目的是为了使用第三部中的Coarse Model 在Task666_FineFinetune上进行微调，在这里使用的是全局归一化算法。
cd nnUNet-master-finetune-fineseg
pip install -e .
python crop_img2.py
nnUNet_plan_and_preprocess -t 666 -pl2d None
nnUNet_train 3d_lowres nnUNetTrainerV2 666 0 -pretrained_weights nnUNet_trained_models/nnUNet/3d_fullres/Task777_CoarseFinetune/nnUNetTrainerV2__nnUNetPlansv2.1/fold_0/model_final_checkpoint.model

####Important####
How to infer in our new engine for your new model
1.我们对nnUNet构建了推理引擎，在Infer中。
cd Infer
python predict.py -i input -o output

Our coarse and fine model Link is at:
链接: https://pan.baidu.com/s/1qJjSktn8dKhKCmzC-I5flw?pwd=lfaj 提取码: lfaj 
--来自百度网盘超级会员v2的分享





